
<html>
    <head>
        <title>ZeroSchool</title>
        <link rel="stylesheet" href="https://unpkg.com/terminal.css@0.7.1/dist/terminal.min.css" />
        <link href="https://unpkg.com/nes.css@2.3.0/css/nes.min.css" rel="stylesheet">
        <link href="https://unpkg.com/dialog-polyfill@0.5.1/dist/dialog-polyfill.css" rel="stylesheet" type="text/css">
        <link href="/styles/main.css" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="favicon.png" type="image/png">
    </head>
    <style>
        h1{
            font-size: 5.4vh;
            font-family: "fixedsys_excelsior_3.01Rg";
            color: #21e800;
        }
    </style>
    <body onload="info()">
        <div class="terminal-nav" style="text-align:center; align-content:center; align-items:center; justify-content: center;"><h1>ZeroSchool - v0.1</h1></div>
        <div class="container flex-container" id="log" style="white-space: pre-line;">
            <p>Login with:</p>
            <a style="color:#0021e8;border-color:#0021e8;" class="btn btn-primary btn-ghost" id="relayX" onclick="relayXLogin()">RelayX</a><br>
            <a style="color:#21e800;border-color:#21e800;" class="btn btn-primary btn-ghost" id="MB" onclick="imbLogin()">MoneyButton</a><br>
            <a style="color:#e80021;border-color:#e80021;" class="btn btn-primary btn-ghost" id="logout" onclick="logout()">Logout</a><br>
            <a style="color:#21e800;border-color:#21e800;" class="btn btn-primary btn-ghost" id="info" onclick="info()">Infos</a><br>
            <a style="color:#0021e8;border-color:#0021e8;" class="btn btn-primary btn-ghost" id="buybsv" onclick="buybsv()">Buy Bits</a>
        </div>
    </body>
<script src="https://unpkg.com/bsv@0.30.0/bsv.min.js" defer></script>
<script src="https://unpkg.com/axios/dist/axios.min.js" defer></script>
<script src="https://www.moneybutton.com/moneybutton.js"></script>
<script src="https://one.relayx.io/relayone.js" defer></script>
<script src="https://otc-staging.relayx.io/relayotc.js"></script>
<script>
    const zeroURL = "https://zeroschool.org";
    function logout(){localStorage.clear();alert("Logged out!");location.reload()}
    async function relayXLogin(){
        let token = await relayone.authBeta({withGrant:true}), res;
        localStorage.setItem('token', token);
        let [payload, signature] = token.split(".");
        const data = JSON.parse(atob(payload));
        let content = await axios.get('https://auth.twetch.app/api/v1/challenge');
        localStorage.setItem('msg', content.data.message);
        try {res = await relayone.sign(content.data.message)}catch(e){alert(e)}
        let publicKey = bsv.PublicKey.fromHex(data.pubkey);
        let signAddr = bsv.Address.fromPublicKey(publicKey);
        if (res){saveWallet(data.paymail, data.pubkey, res.value, signAddr.toString(), 'relayx')}
        if (localStorage.getItem('paymail')){window.location.href = zeroURL}
    }
    function saveWallet(paymail, pubkey, signature, address, wallet){
        localStorage.setItem('paymail', paymail);
        localStorage.setItem('pubkey', pubkey);
        localStorage.setItem('signature', signature);
        localStorage.setItem('address', address);
        localStorage.setItem('wallet', wallet);
    }
    function savePermissionToken(token) {localStorage.setItem('token', token)}
    function getPermissionForCurrentUser() {if (localStorage.getItem('token')) {return localStorage.getItem('token')}}
    const imb = new moneyButton.IMB({
        clientIdentifier: "ce4eb6ea41a4f43044dd7e71c08e50b2",
        permission: getPermissionForCurrentUser(), onNewPermissionGranted: (token) => savePermissionToken(token)
    });
    async function imbLogin(){
        let content = await axios.get('https://auth.twetch.app/api/v1/challenge');
        localStorage.setItem('msg', content.data.message);
        var cryptoOperations = [
            {name:'mySignature',method:'sign',data:localStorage.getItem('msg'),dataEncoding:'utf8',key:'identity',algorithm:'bitcoin-signed-message'},
            {name:'myPublicKey',method:'public-key',key:'identity'},{name: 'myAddress',method: 'address',key: 'identity'}
        ];
        imb.swipe({cryptoOperations: cryptoOperations,
            onCryptoOperations: (ops) => {
                saveWallet(ops[1].paymail, ops[1].value, ops[0].value, ops[2].value, 'moneybutton');
                if (localStorage.getItem('paymail')){window.location.href = zeroURL}
            }
        });
    }
    
    function info(){
        showPopup(`<p class="title" style="color: #21e800; font-family: fixedsys_excelsior_3.01Rg;">Welcome to ZeroSchool!</p><p style="font-family: fixedsys_excelsior_3.01Rg">ZeroSchool is a state of the art fren-2-fren Education System built for the 22nd Century.<br><br>
            Posts, likes, tipping, & Boost are currently supported along with Bitcoinfiles & Relay OTC integration.<br><br>
            Likes are 10 cents.<br><br>
            You'll need a <a href="https://twetch.app">Twetch</a> account to get you started, so grab an invite here: <a href="https://twet.ch/inv/zeroschool">https://twet.ch/inv/zeroschool</a> , or don't, whatever..<br><br>
            <br>
               <blockquote>"Most learning is not the result of instruction. It is rather the result of unhampered participation in a <b>meaningful setting</b>.
Most people learn by being "with it", yet school makes them identify their, cognitive growth with elaborate planning and manipulation." - <i>Ivan Ilitch, Deschooling society</i></blockquote>
            <br>
            Post, Discuss, Rate real world problems, Learn by doing so, and get paid. What are you waiting for?<br><br>
            More to come, or not...</p>`, 'Enter', false)
    }
    
    function buybsv() {
    relayotc.buy('widget-container', {
        referrer: "coin@relayx.io"
    })
    }
    
</script>
</html>
